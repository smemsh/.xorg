#
# sdorfehs (nee ratpoison) runcom
# scott@smemsh.net
# https://github.com/smemsh/.xorg/
#
# TODO: comments must start before keyword or get consumed as value tokens
#
##############################################################################

set startupmessage 0
set msgwait 0
set vscreens 2
set ignoreresizehints 1
set rudeness 31

chdir

#
alias vsel vselect

# XXX make this infinite, use readline, load it on start
set historysize 999

# use fc-list to see fonts (ie, uses fontconfig names)
set font inconsolata-14

set fgcolor LightGreen
set bgcolor Black
set bargravity ne
set barsticky 0

set barpadding 0 0
set barborder 0
set padding 0 0 0 0
set waitcursor 1

# 0 -> st/urxvt, 1 -> urxvtc, but breaks execv
set winaddcurvscreen 0

# %a by the application name (resource name),
# %c by the resource class,
# %f by the frame number,
# %g by the gravity of the window,
# %h by the height of the window,
# %H by the unit to resize the window vertically (height_inc)
# %i by the X Window ID,
# %p by the process ID,
# %l by the last access number,
# %M by the string Maxsize, if it specifies a maximum size,
# %n by the window number,
# %s by window status [* active, + prev, - otherwise] # XXX TODO stack
# %S by the screen number
# %t by the window name (see set winname),
# %T by the string Transient, if it is a transient window
# %w by the width of the window
# %W by the unit to resize the window horizontally (width_inc)
# %x by the xrandr screen number and
# %% by a single %
# XXX TODO controlling tty
# XXX TODO session id, etc (all ps -o)
# XXX TODO callout for string
# XXX TODO dlopen common externals to avoid fork, etc.
# XXX TODO value of environmnet variable
# XXX TODO overload 'name' to ferry in external data?
#
# TODO this doesn't seem to actually work for field widths and
#   other things like '-' for alignment (just breaks); hack
#   ratpoison to do a real printf template
#
#set winfmt %2s %5l %i %T %30t
set winfmt %2s %5l %n %T %30t
set winname name

# hooks
#
#deletewindow	Run after a window is withdrawn.
#key		Run whenever a top level key is pressed.
#newwindow	Run after a new window is mapped.
#quit		Run before exiting ratpoison.
#restart	Run before restarting ratpoison.
#switchframe	Run after a frame actually switched, but
#		before  the window in it is focused.
#switchscreen	Run when the user switches to a different screen.
#switchvscreen	Run when the user switches to a different virtual screen.
#switchwin	Run after a new window is selected.  (With
#		dedication, it may already be inactive
#		again, if it  was put  into  another frame)
#
# the below is needed when switching manually to different group
# to maintain the window list if present pre-switch (and not
# display it if not)
#
#addhook switchvscreen other
#addhook switchvscreen vscreens

#addhook switchwin exec ratpoison -c groups | sed -r 's,^[0-9]*.,,'
#addhook deletewindow exec # want group name port pid

### TOP ######################################################################

undefinekey top C-t

definekey top M-grave           colon
definekey top M-space           other
definekey top C-space           vother
definekey top M-j               vnext
definekey top M-k               vprev
definekey top M-h               prev
definekey top M-l               next

definekey top M-P               exec rp vmove p; rp vother; rp other
definekey top M-W               exec rp vmove w; rp vother; rp other
definekey top M-Q               exec rp vmove q; rp vother; rp other

#definekey top M-b               exec ggw `ratpoison -c "prompt search: "`
definekey top M-b               exec rp echo $(batt)
definekey top M-semicolon       execa rpafter gui-browser --profile-directory="Default"
definekey top M-w               execa rpafter gui-browser --profile-directory="Profile 1"
definekey top M-p               verbexec ppause brave-browser
definekey top M-u               verbexec presume brave-browser
definekey top M-i               exec xinvert
definekey top M-t               exec rp echo "$(TIMEWARRIORDB=$HOME/.task taskline)"

definekey top M-q               delete
definekey top M-bracketleft     vscreens
definekey top M-bracketright    windows
definekey top M-Return          execa rpafter exec st
definekey top M-apostrophe      title
definekey top M-period          exec rpright
definekey top M-comma           exec rpleft
definekey top M-backslash       exec rprenumber
definekey top M-slash           select
definekey top C-slash           vselect

definekey top M-0               select 0
definekey top M-1               select 1
definekey top M-2               select 2
definekey top M-3               select 3
definekey top M-4               select 4
definekey top M-5               select 5
definekey top M-6               select 6
definekey top M-7               select 7
definekey top M-8               select 8
definekey top M-9               select 9

# M-m + key -> M-key, since we use already use the meta key for top binds
newkmap metagen
definekey metagen a meta M-a
definekey metagen b meta M-a
definekey metagen c meta M-a
definekey metagen d meta M-a
definekey metagen e meta M-a
definekey metagen f meta M-a
definekey metagen g meta M-a
definekey metagen h meta M-a
definekey metagen i meta M-a
definekey metagen j meta M-a
definekey metagen k meta M-a
definekey metagen l meta M-a
definekey metagen m meta M-a
definekey metagen n meta M-a
definekey metagen o meta M-a
definekey metagen p meta M-a
definekey metagen q meta M-a
definekey metagen r meta M-a
definekey metagen s meta M-a
definekey metagen t meta M-a
definekey metagen u meta M-a
definekey metagen v meta M-a
definekey metagen w meta M-a
definekey metagen x meta M-a
definekey metagen y meta M-a
definekey metagen z meta M-a
definekey top M-m readkey metagen

# S-space seems to be unavailable in curses apps, so we send with Control
# instead so we can map into application (we prefix+C-Space in tmux)
#
definekey top S-s-space exec rpmeta C-q C-space

### RPINIT ###################################################################
#
# note: should be idempotent, to survive "ratpoison -c restart", etc
# note: exec passed unaltered to 'sh -c' so be sure no bashisms

# use a compositor, otherwise tearing artifacts in some gui apps
#verbexec xsetroot -solid black
execw hsetroot -solid '#000000'
execw picom -b

#
execw xrdb -load ~/.Xresources

# start at least one window during init, or rpafter will fail because no
# current window exists.  we always start a terminal first thing anyways.
#
vsel 1
vrename p
vsel 0
vrename w
execv 0 exec st
execv 1 exec st

# keyboard, touchpad, mouse, etc
execa xbanish
execw xinputs
exec rptmux

# TODO: rename windows, but hooks don't seem to run from events in rcfile, and
# setting title of window 0 will race with terminal spawn and win every time
